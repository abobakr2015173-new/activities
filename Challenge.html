<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­ÙƒØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root {
            --primary-color: #6a5acd;
            --background-gradient: linear-gradient(135deg, #74EBD5 0%, #9FACE6 100%);
            --container-bg: #ffffff;
            --text-color: #333;
            --gold: #ffc107;
            --silver: #ced4da;
            --bronze: #cd7f32;
            --green: #28a745;
            --red: #dc3545;
            --blue: #0d6efd;
            --dark-slate: #343a40;
            --info-blue: #0dcaf0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø´Ø±Ø§Ø¦Ø· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù‚ØµØ§ØµØ§Øª */
        }

        .container {
            background: var(--container-bg);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 2.2em;
            font-weight: 900;
        }
        
        h2 {
            text-align: center;
            font-weight: 700;
            color: #555;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .screen { display: none; }
        .screen.active { display: block; }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(106, 90, 205, 0.2);
            outline: none;
        }

        button {
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        .btn-add {
            background: var(--primary-color);
            color: white;
            padding: 0 25px;
        }
        
        .btn-add:hover { background: #5a4acd; }
        
        .btn-main {
            width: 100%;
            background: var(--green);
            color: white;
            padding: 18px;
            font-size: 18px;
            margin-top: 20px;
        }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }
        
        .players-box {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 12px;
            min-height: 70px;
        }

        .player-tag {
            display: inline-flex;
            align-items: center;
            background: var(--primary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 5px;
            font-weight: 700;
        }

        .player-tag .remove-btn {
            background: rgba(0,0,0,0.2);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px; /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† margin-right Ø¥Ù„Ù‰ margin-left Ø¨Ø³Ø¨Ø¨ dir=rtl */
            cursor: pointer;
            line-height: 20px;
            text-align: center;
            padding: 0;
            font-size: 14px;
        }

        /* Scoreboard Styling */
        .scoreboard-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .score-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 16px;
            font-size: 1.2em;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        /* Winner styles */
        .score-row.rank-1 { background: var(--gold); color: #333; }
        .score-row.rank-2 { background: var(--silver); color: #333; }
        .score-row.rank-3 { background: var(--bronze); color: white; }
        .score-row.rank-3 .player-name, .score-row.rank-3 .score-display { color: white; }
        
        .player-name {
            flex-grow: 1;
            text-align: right;
            color: #333;
        }
        
        .score-display {
            background: var(--blue);
            color: white;
            min-width: 50px;
            height: 50px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            font-size: 1.1em;
            font-weight: 900;
            transition: transform 0.2s ease; /* transition for score pop */
        }
        
        .score-pop {
            transform: scale(1.2);
        }
        
        .btn-score {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            line-height: 50px;
            padding: 0;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-score:active { transform: scale(0.9); box-shadow: none; }
        
        .btn-plus { background: var(--green); }
        .btn-minus { background: var(--red); }
        
        .actions-footer {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        .actions-footer button {
            padding: 15px 5px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ø´ÙŠØ© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø«Ù„Ø§Ø«Ø© */
            font-size: 1.0em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .actions-footer button:active { transform: scale(0.95); box-shadow: none; }
        
        .btn-winner { background: var(--gold); color: var(--text-color); }
        .btn-edit { background: var(--info-blue); color: white; }
        .btn-reset { background: var(--dark-slate); color: white; }

        /* Confetti Styles */
        .confetti {
            width: 10px;
            height: 10px;
            background-color: #f00;
            position: absolute;
            will-change: transform, opacity;
            animation: fall 3s linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Screen 1: Add Players -->
        <div id="setupScreen" class="screen">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­ÙƒØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
            <div class="input-group">
                <input type="text" id="nameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ Ø£Ùˆ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©">
                <button class="btn-add" onclick="addPlayer()">Ø£Ø¶Ù</button>
            </div>
            
            <div class="players-box" id="playersSetupBox"></div>

            <button class="btn-main" id="startGameBtn" onclick="startGame()" disabled>Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â–¶ï¸</button>
        </div>

        <!-- Screen 2: Scoreboard -->
        <div id="gameScreen" class="screen">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­ÙƒØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
            <h2>Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
            <div class="scoreboard-area" id="scoreboardArea"></div>
            
            <div class="actions-footer">
                 <button class="btn-winner" onclick="declareWinners()">Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† ğŸ¥‡</button>
                 <button class="btn-edit" onclick="editPlayers()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† âœï¸</button>
                 <button class="btn-reset" onclick="resetGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let isSorted = false;
        let gameInProgress = false;

        const setupScreen = document.getElementById('setupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const nameInput = document.getElementById('nameInput');
        const playersSetupBox = document.getElementById('playersSetupBox');
        const startGameBtn = document.getElementById('startGameBtn');
        const scoreboardArea = document.getElementById('scoreboardArea');
        
        document.addEventListener('DOMContentLoaded', loadState);
        nameInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') addPlayer();
        });

        function saveState() {
            const state = { players, gameInProgress };
            localStorage.setItem('scoreboardState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('scoreboardState');
            if (savedState) {
                const state = JSON.parse(savedState);
                players = state.players || [];
                gameInProgress = state.gameInProgress || false;

                if (gameInProgress && players.length > 0) {
                    isSorted = false;
                    renderScoreboard();
                    showScreen(gameScreen);
                } else {
                    renderSetupList();
                    showScreen(setupScreen);
                }
            } else {
                renderSetupList();
                showScreen(setupScreen);
            }
        }

        function showScreen(screenToShow) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            screenToShow.classList.add('active');
        }

        function addPlayer() {
            const name = nameInput.value.trim();
            if (!name) return;
            if (players.some(p => p.name === name)) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ù…Ø±ØªÙŠÙ†.');
                return;
            }
            players.push({ name: name, score: 0 });
            nameInput.value = '';
            nameInput.focus();
            renderSetupList();
            if(gameInProgress) saveState();
        }
        
        function removePlayer(nameToRemove) {
            players = players.filter(p => p.name !== nameToRemove);
            renderSetupList();
             if(gameInProgress) saveState();
        }
        
        function renderSetupList() {
            if (players.length === 0) {
                playersSetupBox.innerHTML = '<p style="text-align: center; color: #999;">Ø£Ø¶Ù Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>';
                startGameBtn.disabled = true;
                startGameBtn.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â–¶ï¸';
            } else {
                playersSetupBox.innerHTML = players.map(p => 
                    `<span class="player-tag"><button class="remove-btn" onclick="removePlayer('${p.name}')">âœ•</button>${p.name}</span>`
                ).join('');
                startGameBtn.disabled = false;
                if(gameInProgress){
                    startGameBtn.textContent = 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø© â†©ï¸';
                } else {
                    startGameBtn.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â–¶ï¸';
                }
            }
        }
        
        function startGame() {
            gameInProgress = true;
            isSorted = false;
            saveState();
            renderScoreboard();
            showScreen(gameScreen);
        }

        function editPlayers() {
            showScreen(setupScreen);
            renderSetupList();
        }
        
        function renderScoreboard() {
            const playersToRender = isSorted ? [...players].sort((a, b) => b.score - a.score) : players;
            
            const ranks = {};
            let currentRank = 0;
            let lastScore = -Infinity;
            [...players].sort((a, b) => b.score - a.score).forEach((p, index) => {
                if (p.score !== lastScore) {
                    currentRank = index + 1;
                    lastScore = p.score;
                }
                ranks[p.name] = currentRank;
            });

            scoreboardArea.innerHTML = playersToRender.map(player => {
                const rank = ranks[player.name];
                const rankClass = isSorted ? getRankClass(rank) : '';
                return `
                    <div class="score-row ${rankClass}" data-player-name="${player.name}">
                        <span class="player-name">${player.name}</span>
                        <span class="score-display">${player.score}</span>
                        <button class="btn-score btn-plus" onclick="updateScore('${player.name}', 1)">+</button>
                        <button class="btn-score btn-minus" onclick="updateScore('${player.name}', -1)">-</button>
                    </div>
                `;
            }).join('');
        }
        
        function updateScore(nameToUpdate, amount) {
            const player = players.find(p => p.name === nameToUpdate);
            if (player) {
                player.score += amount;
                if (player.score < 0) player.score = 0;
                
                if (isSorted) {
                    renderScoreboard();
                } else {
                    const row = scoreboardArea.querySelector(`.score-row[data-player-name="${nameToUpdate}"]`);
                    if (row) {
                        const scoreDisplay = row.querySelector('.score-display');
                        scoreDisplay.textContent = player.score;
                        scoreDisplay.classList.add('score-pop');
                        setTimeout(() => scoreDisplay.classList.remove('score-pop'), 200);
                    }
                }
                saveState();
            }
        }

        function declareWinners() {
            isSorted = true;
            launchConfetti();
            renderScoreboard();
        }

        function getRankClass(rank) {
            if (rank === 1) return 'rank-1';
            if (rank === 2) return 'rank-2';
            if (rank === 3) return 'rank-3';
            return '';
        }
        
        function resetGame() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ù„Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©.')) {
                players = [];
                isSorted = false;
                gameInProgress = false;
                localStorage.removeItem('scoreboardState');
                renderSetupList();
                showScreen(setupScreen);
            }
        }

        function launchConfetti() {
            const colors = ['#ffc107', '#28a745', '#dc3545', '#0d6efd', '#6a5acd'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = Math.random() * -50 + 'vh';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 3000);
            }
        }
    </script>
</body>
</html>
